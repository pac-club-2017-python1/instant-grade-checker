<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Student Information System</title>

    <style>
        label {
            padding-top: 5px;
        }

        .error {
            border: 1px solid red !important;
        }

        .glyphicon-refresh-animate {
            -animation: spin .7s infinite linear;
            -webkit-animation: spin2 .7s infinite linear;
        }

        @-webkit-keyframes spin2 {
            from { -webkit-transform: rotate(0deg);}
            to { -webkit-transform: rotate(360deg);}
        }

        @keyframes spin {
            from { transform: scale(1) rotate(0deg);}
            to { transform: scale(1) rotate(360deg);}
        }
    </style>

    <!-- Bootstrap core CSS -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">


    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>


    <script src="bower_components/bootstrap-validator/dist/validator.min.js"></script>
    <link href="bower_components/toastr/toastr.min.css" rel="stylesheet">
    <script src="bower_components/toastr/toastr.min.js"></script>

    <link href="bower_components/bootstrap-toggle/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="bower_components/bootstrap-toggle/js/bootstrap-toggle.min.js"></script>

    <!--<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">-->
    <link href="css/custom.css" rel="stylesheet">

</head>

<body>
<div class="jumbotron">
    <div class="container">
        <h1 class="display-3">Registration</h1>
        <p>Complete the following steps to complete your registration</p>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="container">
            <div class="row form-group">
                <div class="col-xs-12">
                    <ul class="nav nav-pills nav-justified thumbnail setup-panel">
                        <li class="active"><a href="#step-1">
                            <h4 class="list-group-item-heading">Step 1</h4>
                            <p class="list-group-item-text">Basic Information</p>
                        </a></li>
                        <li class="disabled"><a href="#step-2">
                            <h4 class="list-group-item-heading">Step 2</h4>
                            <p class="list-group-item-text">User Agreement</p>
                        </a></li>
                        <li class="disabled"><a href="#step-3">
                            <h4 class="list-group-item-heading">Step 3</h4>
                            <p class="list-group-item-text">Fingerprinting (optional)</p>
                        </a></li>
                        <li class="disabled"><a href="#step-4">
                            <h4 class="list-group-item-heading">Step 4</h4>
                            <p class="list-group-item-text">Finish Up</p>
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>

        <form class="container" disabled>
            <div class="row setup-content" id="step-1" hidden>
                <div class="col-xs-12">
                    <div class="col-md-12 well text-center">
                        <h1> Basic Information</h1>

                        <br>
                        <form id="basic-information" class="form-horizontal" data-toggle="validator">
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="student-id">Student ID:</label>
                                <div class="col-sm-10">
                                    <input type="tel" maxlength="6" class="form-control" id="student-id"
                                           placeholder="######" autocomplete="off">
                                </div>
                            </div>
                            <br>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="password">School Password:</label>
                                <div class="col-sm-10">
                                    <input type="password" class="form-control" id="password" placeholder="Password" autocomplete="off">
                                </div>
                            </div>
                            <br>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="pin">PIN:</label>
                                <div class="col-sm-10">
                                    <input type="tel" maxlength="6" class="form-control" id="pin" placeholder="######" autocomplete="off">
                                </div>
                            </div>
                            <br>
                            <hr>
                            <button id="activate-step-2" class="btn btn-primary btn-lg"><span id="processingSpinner" class="glyphicon glyphicon-refresh glyphicon-refresh-animate" style="visibility: hidden; display: none;"></span> Next</button>
                        </form>
                        <div class="row" style="padding-top: 10px;">
                            <button class="btn btn-default btn-lg pull-left" style="margin-left: 20px;" id="backButton">Back</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <form class="container" disabled>
            <div class="row setup-content" id="step-2" hidden>
                <div class="col-xs-12">
                    <div class="col-md-12 well text-center">
                        <h1 class="text-center"> User Agreement</h1>

                        <iframe src="https://docs.google.com/document/d/1Ef_MU8dJ1Sj9PLqT8BF7sAtggB2BeeAY09kKurshhCI/pub?embedded=true" style="width: 90%; height: 40%;"></iframe>

                        <button id="activate-step-3" class="btn btn-primary btn-lg">Agree and Next</button>
                    </div>
                </div>
            </div>
        </form>

        <form class="container" disabled>
            <div class="row setup-content" id="step-3" hidden>
                <div class="col-xs-12">
                    <div class="col-md-12 well text-center">
                        <h1 class="text-center"> Fingerprinting</h1>
                        <p>Have your parents signed the fingerprinting waiver? <input type="checkbox" id="waiver" data-toggle="toggle" data-on="Yes" data-off="No" data-onstyle="success" data-offstyle="danger"></p>
                        <button id="recordFingerprint" class="btn btn-success btn-lg" disabled>Record your Fingerprint</button>
                        <hr>
                        <button id="activate-step-4" class="btn btn-primary btn-lg">Next</button>
                    </div>
                </div>
            </div>
        </form>

        <form class="container" disabled>
            <div class="row setup-content" id="step-4" hidden>
                <div class="col-xs-12">
                    <div class="col-md-12 well text-center">
                        <h1 class="text-center"> Finished</h1>
                        <p>Thank you for registering for this application!</p>

                        <button class="btn btn-secondary btn-lg" id="finishButton">Finish</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <hr>

    <div class="modal fade" tabindex="-1" role="dialog" id="fingerprintModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Record Fingerprint</h4>
                </div>
                <div class="modal-body">
                    <p>Press your finger on the scanner, and hold until the scanner light turns off.</p>
                    <button id="startFingerprint" class="btn btn-success">Start</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <footer>
        <p>&copy; VBCPS 2017</p>
    </footer>
</div> <!-- /container -->


<script>
    $(document).ready(function () {
        var token = "";

        var navListItems = $('ul.setup-panel li a'),
            allWells = $('.setup-content');

        allWells.hide();

        navListItems.click(function (e) {
            e.preventDefault();
            var $target = $($(this).attr('href')),
                $item = $(this).closest('li');

            if (!$item.hasClass('disabled')) {
                navListItems.closest('li').removeClass('active');
                $item.addClass('active');
                allWells.hide();
                $target.show();
            }
        });

        $('ul.setup-panel li.active a').trigger('click');

        // DEMO ONLY //
        $('#activate-step-2').on('click', function (e) {
            e.preventDefault();
            $("#activate-step-2").prop("disabled",true);

            var studentId = $("#student-id").val();
            var password = $("#password").val();
            var pin = $("#pin").val();
            var canContinue = true;

            if (studentId.length < 6) {
                $("#student-id").addClass("error");
                canContinue = false;
            }

            if (pin.length < 6) {
                $("#pin").addClass("error");
                canContinue = false;
            }

            if (password.length <= 4) {
                $("#password").addClass("error");
                canContinue = false;
            }

            if(canContinue){
                $("#processingSpinner").css('visibility', 'visible');
                $("#processingSpinner").css('display', 'inline-block');
                $("#backButton").css('visibility', 'hidden');

                toastr.info('This may take up to a minute', 'Processing');
                $.post("http://127.0.0.1:5000/api/register", { studentId: studentId, password: password, pin: pin}, function( data ) {
                    if(data.toString().startsWith("OK")){
                        token = data.toString().split(";")[1];
                        $("#student-id").removeClass("error");
                        $("#pin").removeClass("error");
                        $("#password").removeClass("error");

                        $("#student-id").attr("disabled", "disabled");
                        $("#pin").attr("disabled", "disabled");
                        $("#password").attr("disabled", "disabled");

                        $("#step-2").css('visibility', 'visible');
                        $('ul.setup-panel li:eq(1)').removeClass('disabled');
                        $('ul.setup-panel li a[href="#step-2"]').trigger('click');
                        $("#activate-step-2").remove();
                    }else{
                        $("#activate-step-2").prop("disabled",false);
                        $("#processingSpinner").css('visibility', 'hidden');
                        $("#processingSpinner").css('display', 'none');
                        $("#password").addClass("error");
                        $("#student-id").addClass("error");
                        $("#backButton").css('visibility', 'visible');
                        toastr.error(data, 'Incorrect values')
                    }
                });
            }else{
                toastr.error('Please input correct values', 'Incorrect values')
            }
        });

        $('#activate-step-3').on('click', function (e) {
            e.preventDefault();
            $("#step-3").css('visibility', 'visible');
            $('ul.setup-panel li:eq(2)').removeClass('disabled');
            $('ul.setup-panel li a[href="#step-3"]').trigger('click');
            $(this).remove();
        });

        $('#activate-step-4').on('click', function (e) {
            e.preventDefault();
            var checked = $('#waiver').prop('checked');
            $.get("http://127.0.0.1:5000/api/allowFingerprintStatus?allowFingerprint=" + checked, function( data ) {
                if(data !== "OK"){
                    toastr.error(data, "Message");
                }else{
                    $("#step-4").css('visibility', 'visible');
                    $('ul.setup-panel li:eq(3)').removeClass('disabled');
                    $('ul.setup-panel li a[href="#step-4"]').trigger('click');
                    $(this).remove();
                }
            });
        });

        $('#finishButton').on('click', function (e){
            e.preventDefault();
            console.log("Using token: " + token);
            document.location = "dashboard.html?token=" + token;
        });

        $('#backButton').on('click', function (e){
            e.preventDefault();
            document.location = "index.html";
        });

        $("#recordFingerprint").click(function(e){
            e.preventDefault();
            $("#fingerprintModal").modal('show');
        });

        $("#startFingerprint").click(function(e){
            e.preventDefault();
            var checked = $('#waiver').prop('checked');
            $.get("http://127.0.0.1:5000/api/enrollFp?token=" + token + "&allowFingerprint=" + checked, function( data ) {
                $("#fingerprintModal").modal('hide');
                if(data !== "OK"){
                    toastr.error(data, "Message");
                }else{
                    toastr.success("Successfully enrolled fingerprint", "Success");
                }
            });
        });

        $("#waiver").change(function(){
            var checked = $('#waiver').prop('checked');
            $("#recordFingerprint").attr("disabled", !checked)
        });
        $('#waiver').bootstrapToggle();
    });
</script>


</body>
</html>
